<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>å‘¼å¸å™¨æ¨¡å¼é€ŸæŸ¥ (PT Edition)</title>
<style>
:root{
  --bg: #f8fafc; 
  --card: #ffffff; 
  --text: #334155; 
  --text-light: #64748b;
  --border: #e2e8f0;
  
  /* Severity Colors */
  --sev-critical: #ef4444; /* CMV */
  --sev-severe: #f97316;   /* A/C */
  --sev-mod: #eab308;      /* SIMV */
  --sev-mild: #22c55e;     /* CPAP */

  --accent: #3b82f6;
  --radius: 12px;
  --header-h: 60px;
  --sidebar-w: 260px;
}

[data-theme="dark"]{
  --bg: #0f172a; --card: #1e293b; --text: #f1f5f9; --text-light: #94a3b8;
  --border: #334155;
  --sev-critical: #f87171; --sev-severe: #fb923c; --sev-mod: #facc15; --sev-mild: #4ade80;
  --accent: #60a5fa;
}

*{box-sizing:border-box}
body{font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Microsoft JhengHei", sans-serif; margin:0; background:var(--bg); color:var(--text); height:100vh; overflow:hidden;}

/* Layout */
.header{
  height:var(--header-h); background:var(--card); border-bottom:1px solid var(--border);
  display:flex; align-items:center; padding:0 16px; position:fixed; top:0; width:100%; z-index:50;
}
.app-title{font-weight:800; font-size:18px; display:flex; align-items:center; gap:8px;}
.severity-badge{font-size:10px; padding:2px 6px; border-radius:4px; background:#eee; color:#666; font-weight:normal;}

.container{display:flex; height:calc(100vh - var(--header-h)); margin-top:var(--header-h);}

/* Sidebar */
.sidebar{
  width:var(--sidebar-w); background:var(--card); border-right:1px solid var(--border);
  overflow-y:auto; flex-shrink:0; display:flex; flex-direction:column;
}
.nav-group-title{
  padding:16px 16px 8px; font-size:12px; font-weight:700; color:var(--text-light); text-transform:uppercase; letter-spacing:0.5px;
}
.nav-item{
  padding:14px 16px; border-bottom:1px solid var(--border); cursor:pointer;
  display:flex; align-items:center; justify-content:space-between; transition:0.2s;
}
.nav-item:hover{background:var(--bg);}
.nav-item.active{background:var(--bg); border-left:4px solid var(--accent);}
.nav-title{font-weight:700; font-size:16px;}
.nav-desc{font-size:12px; color:var(--text-light);}
.dot{width:10px; height:10px; border-radius:50%;}

/* Main Content */
.main{flex:1; overflow-y:auto; padding:24px; scroll-behavior:smooth;}

/* Cards */
.mode-header{margin-bottom:24px;}
.mode-title{font-size:28px; font-weight:800; margin:0 0 8px 0; color:var(--text);}
.mode-meta{display:flex; gap:12px; font-size:14px; color:var(--text-light);}

.waveform-box{
  background:var(--card); border:1px solid var(--border); border-radius:var(--radius);
  height:200px; padding:20px; margin-bottom:24px; position:relative;
  display:flex; align-items:center; justify-content:center;
}
.waveform-box svg{width:100%; height:100%;}
.waveform-label{position:absolute; bottom:10px; right:12px; font-size:11px; opacity:0.5;}

.grid-2{display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-bottom:16px;}
.card{background:var(--card); padding:20px; border-radius:var(--radius); border:1px solid var(--border);}
.card-title{
  font-size:14px; font-weight:700; margin-bottom:12px; display:flex; align-items:center; gap:8px;
  text-transform:uppercase; letter-spacing:0.5px;
}

/* Color Accents */
.c-red .card-title{color:var(--sev-critical);} .c-red{border-top:3px solid var(--sev-critical);}
.c-orange .card-title{color:var(--sev-severe);} .c-orange{border-top:3px solid var(--sev-severe);}
.c-yellow .card-title{color:var(--sev-mod);} .c-yellow{border-top:3px solid var(--sev-mod);}
.c-green .card-title{color:var(--sev-mild);} .c-green{border-top:3px solid var(--sev-mild);}
.c-blue .card-title{color:var(--accent);}

/* List & Content */
ul{margin:0; padding-left:18px;} li{margin-bottom:6px; line-height:1.5; font-size:15px;}
.data-table{width:100%; border-collapse:collapse; font-size:14px;}
.data-table td{padding:6px 0; border-bottom:1px dashed var(--border);}
.data-table td:first-child{color:var(--text-light); width:40%;}
.data-table td:last-child{font-weight:600;}

/* Mobile */
.menu-toggle{display:none; padding:10px; cursor:pointer;}
@media(max-width:768px){
  .sidebar{position:fixed; top:var(--header-h); bottom:0; left:-100%; z-index:40; transition:0.3s; width:80%; box-shadow:4px 0 20px rgba(0,0,0,0.1);}
  .sidebar.open{left:0;}
  .menu-toggle{display:block;}
  .grid-2{grid-template-columns:1fr;}
}

</style>
</head>
<body>

<div class="header">
  <div class="menu-toggle" onclick="toggleMenu()">â˜°</div>
  <div class="app-title">
    å‘¼å¸å™¨æ¨¡å¼é€ŸæŸ¥ <span class="severity-badge">PT Pro Edition</span>
  </div>
</div>

<div class="container">
  <div class="sidebar" id="sidebar">
    <div class="nav-group-title">ä¾ç—…æƒ…åš´é‡åº¦æ’åº (Severity)</div>
    <div id="navList"></div>
  </div>

  <div class="main" id="mainContent">
    <!-- Content injected via JS -->
  </div>
</div>

<script>
// --- Data Structure (Sorted by Severity) ---
const modes = [
  {
    id: 'cmv',
    code: 'CMV / VCV',
    name: 'Continuous Mandatory Ventilation',
    severity: 'critical',
    severityText: 'æ¥µé‡åº¦ / ç„¡è‡ªä¸»å‘¼å¸',
    desc: 'æ©Ÿå™¨å…¨æ§åˆ¶ã€‚ç—…äººæ²’æœ‰å‡ºåŠ›ï¼Œæ©Ÿå™¨çµ¦äºˆå›ºå®šæ½®æ°£é‡èˆ‡é »ç‡ã€‚',
    content: {
      mechanism: '<b>æ§åˆ¶ä½ç½®ï¼šæ©Ÿå™¨ (Machine)</b><br>ä¸ç®¡ç—…äººæƒ³ä¸æƒ³å¸æ°£ï¼Œæ©Ÿå™¨éƒ½æœƒä¾ç…§è¨­å®šçš„æ™‚é–“ (Time Trigger)ï¼Œå¼·åˆ¶æ‰“å…¥è¨­å®šçš„å®¹ç© (Volume) æˆ–å£“åŠ› (Pressure)ã€‚',
      pt_view: 'ç—…äººå®Œå…¨è¢«å‹• (Passive)ã€‚æ­¤æ™‚å‘¼å¸è‚Œå®Œå…¨ä¸æ”¶ç¸®ï¼Œé•·æœŸä½¿ç”¨æœƒå°è‡´<b>æ©«è†ˆè†œèç¸® (Diaphragm Atrophy)</b>ã€‚',
      indication: '<ul><li>å…¨éº»æ‰‹è¡“ä¸­ã€‚</li><li>åš´é‡è…¦å‚·ã€å‘¼å¸ä¸­æ¨å—æã€‚</li><li>ä½¿ç”¨è‚Œè‚‰é¬†å¼›åŠ‘ (Paralyzed) æˆ–é‡åº¦é®éœæ™‚ã€‚</li></ul>',
      contraindication: '<ul><li>ç—…äººæœ‰æ¸…æ¥šæ„è­˜ä¸”æœ‰è‡ªä¸»å‘¼å¸èƒ½åŠ› (æœƒé€ æˆåš´é‡çš„äººæ©Ÿå°æŠ— fighting)ã€‚</li></ul>',
      complication: '<ul><li><b>å‘¼å¸è‚Œç„¡åŠ›</b>ï¼šå› é•·æœŸå»¢ç”¨ã€‚</li><li><b>Barotrauma (æ°£å£“å‚·)</b>ï¼šè‹¥ lung compliance è®Šå·®ï¼Œç¡¬æ‰“å›ºå®šå®¹ç©æœƒå°è‡´é«˜å£“ã€‚</li><li>å¿ƒè¼¸å‡ºé‡ä¸‹é™ (é«˜èƒ¸å…§å£“å½±éŸ¿éœè„ˆå›æµ)ã€‚</li></ul>',
      pt_action: '<ul><li><b>ä»‹å…¥é‡é»</b>ï¼šæ“ºä½ (Positioning)ã€å§¿ä½å¼•æµã€è¢«å‹•é—œç¯€æ´»å‹• (PROM)ã€‚</li><li><b>ç¦å¿Œ</b>ï¼šä¸å¯é€²è¡Œå‘¼å¸è‚Œè¨“ç·´ (IMT)ï¼Œå› ç‚ºç—…äººç„¡æ³•å‡ºåŠ›ã€‚</li><li><b>æ³¨æ„</b>ï¼šç¿»èº«æˆ–æŠ½ç—°æ™‚æ˜“èª˜ç™¼å’³å—½ï¼Œè§€å¯Ÿé«˜å£“è­¦å ± (High Pressure Alarm)ã€‚</li></ul>',
      data: {
        'Control Variable': 'Volume or Pressure',
        'Trigger': 'Time (æ©Ÿå™¨å®šæ™‚)',
        'Cycle': 'Time/Volume',
        'WOB (Work of Breathing)': 'æ©Ÿå™¨ 100% / ç—…äºº 0%'
      }
    }
  },
  {
    id: 'ac',
    code: 'A/C',
    name: 'Assist / Control',
    severity: 'severe',
    severityText: 'é‡åº¦ / å¾®å¼±è‡ªä¸»å‘¼å¸',
    desc: 'è¼”åŠ©æ§åˆ¶æ¨¡å¼ã€‚ç—…äººå¸æ°£æœƒè§¸ç™¼æ©Ÿå™¨çµ¦ã€Œå…¨é¤ã€ï¼Œä¸å¸æ°£æ©Ÿå™¨æœƒçµ¦ã€Œä¿åº•ã€ã€‚',
    content: {
      mechanism: '<b>æ§åˆ¶ä½ç½®ï¼šæ··åˆ (Patient Trigger + Machine Cycle)</b><br>1. <b>Assist</b>: ç—…äººå¸æ°£å¾®å¼± (Trigger) â†’ æ©Ÿå™¨åµæ¸¬åˆ° â†’ çµ¦äºˆè¨­å®šå¥½çš„ã€Œå®Œæ•´ã€å®¹ç©/å£“åŠ›ã€‚<br>2. <b>Control</b>: ç—…äººå¤ªä¹…æ²’å¸æ°£ â†’ æ©Ÿå™¨ä¾è¨­å®šé »ç‡å¼·åˆ¶çµ¦æ°£ã€‚',
      pt_view: 'æœ€å¸¸ç”¨çš„ ICU æ¨¡å¼ã€‚é›–ç„¶ç—…äººå¯ä»¥æ±ºå®šã€Œä»€éº¼æ™‚å€™å¸ (Rate)ã€ï¼Œä½†ã€Œå¸å¤šæ·± (Volume)ã€é‚„æ˜¯æ©Ÿå™¨æ±ºå®šçš„ã€‚ç—…äººå¯èƒ½æœƒæœ‰éåº¦æ›æ°£ (Hyperventilation) çš„é¢¨éšªã€‚',
      indication: '<ul><li>å‘¼å¸è¡°ç«­ä½†ä»æœ‰å¾®å¼±å‘¼å¸é©…å‹•åŠ› (Drive)ã€‚</li><li>å‘¼å¸è‚Œç–²å‹ï¼Œéœ€è¦æ©Ÿå™¨åˆ†æ“”å¤§éƒ¨åˆ†åšåŠŸ (WOB)ã€‚</li></ul>',
      contraindication: '<ul><li>ç—…äººæ¥µåº¦ç„¦æ…®æˆ–å–˜ (æœƒä¸€ç›´è§¸ç™¼æ©Ÿå™¨ï¼Œå°è‡´å‘¼å¸æ€§é¹¼ä¸­æ¯’)ã€‚</li></ul>',
      complication: '<ul><li><b>Auto-PEEP</b>ï¼šè‹¥ç—…äººå‘¼å¸æ¬¡æ•¸éå¿« (Tachypnea)ï¼Œæ°£é«”ä¾†ä¸åŠå‘¼å‡ºã€‚</li><li>å‘¼å¸æ€§é¹¼ä¸­æ¯’ (Respiratory Alkalosis)ã€‚</li><li>å»¢ç”¨æ€§èç¸® (é›–ç„¶æ¯” CMV å¥½ä¸€é»)ã€‚</li></ul>',
      pt_action: '<ul><li><b>ä»‹å…¥é‡é»</b>ï¼šæ—©æœŸæ´»å‹• (Early Mobilization)ã€‚</li><li><b>æ³¨æ„</b>ï¼šè‹¥é‹å‹•ä¸­ç—…äººå‘¼å¸æ€¥ä¿ƒï¼Œæ©Ÿå™¨æœƒä¸€ç›´çµ¦æ°£ï¼Œéœ€è§€å¯Ÿæœ‰ç„¡ Auto-PEEP (åæ°£å—é˜»)ã€‚</li><li><b>Double Triggering</b>ï¼šè‹¥ç—…äººå¸æ°£éœ€æ±‚å¤§æ–¼æ©Ÿå™¨çµ¦çš„ï¼Œæœƒå‡ºç¾é€£å¸å…©å£ï¼Œéœ€è«‹ RT èª¿æ•´ã€‚</li></ul>',
      data: {
        'Trigger': 'Pressure or Flow (ç—…äººè§¸ç™¼)',
        'Backup Rate': 'æœ‰ (ä¾‹å¦‚ 12-14 bpm)',
        'Tidal Volume': 'å›ºå®š (ä¾‹å¦‚ 450-500ml)',
        'WOB': 'æ©Ÿå™¨ 80-90% / ç—…äºº 10-20%'
      }
    }
  },
  {
    id: 'simv',
    code: 'SIMV + PS',
    name: 'Sync. Intermittent Mandatory Ventilation',
    severity: 'mod',
    severityText: 'ä¸­åº¦ / æº–å‚™è„«é›¢',
    desc: 'åŒæ­¥é–“æ­‡æŒ‡ä»¤ã€‚æ©Ÿå™¨çµ¦å›ºå®šçš„å¹¾å£æ°£ï¼Œå‰©ä¸‹çš„æ™‚é–“ç—…äººè‡ªå·±å¸ (é€šå¸¸æ­é… PS)ã€‚',
    content: {
      mechanism: '<b>æ§åˆ¶ä½ç½®ï¼šæ©Ÿå™¨èˆ‡ç—…äººå…±å­˜</b><br>æ©Ÿå™¨è¨­å®šæ¯åˆ†é˜çµ¦å¹¾æ¬¡ã€Œå¼·åˆ¶æ›æ°£ã€(Mandatory)ï¼Œåœ¨é€™äº›å¼·åˆ¶æ›æ°£çš„ã€Œç©ºæª”ã€ï¼Œå…è¨±ç—…äººé€²è¡Œã€Œè‡ªä¸»å‘¼å¸ã€(Spontaneous)ï¼Œä¸”é€šå¸¸æœƒåŠ ä¸Šå£“åŠ›æ”¯æŒ (Pressure Support) ä¾†å¹«å¿™æ¨ä¸€ä¸‹ã€‚',
      pt_view: 'é€™æ˜¯ä¸€å€‹<b>è¨“ç·´æ¨¡å¼</b>ã€‚ç—…äººçš„æ©«è†ˆè†œé–‹å§‹è¦è² æ“”è¼ƒå¤šçš„åšåŠŸã€‚é€™æ˜¯ PT ä»‹å…¥å‘¼å¸è¨“ç·´çš„å¥½æ™‚æ©Ÿã€‚',
      indication: '<ul><li>Weaning (è„«é›¢å‘¼å¸å™¨) éæ¸¡æœŸã€‚</li><li>éœ€é›éŠå‘¼å¸è‚ŒåŠ›é‡ã€‚</li><li>é é˜²å‘¼å¸è‚Œèç¸®ã€‚</li></ul>',
      contraindication: '<ul><li>ç—…æƒ…ä¸ç©©ã€å‘¼å¸è‚Œæ¥µåº¦ç–²ä¹è€… (æœƒå°è‡´è¡°ç«­)ã€‚</li></ul>',
      complication: '<ul><li><b>å‘¼å¸è‚Œç–²å‹ (Muscle Fatigue)</b>ï¼šè‹¥åƒæ•¸è¨­å¤ªä½ï¼Œç—…äººå¤ªç´¯ã€‚</li><li>äººæ©Ÿä¸åŒæ­¥ (Asynchrony)ã€‚</li></ul>',
      pt_action: '<ul><li><b>ä»‹å…¥é‡é»</b>ï¼šä¸»å‹•å‘¼å¸å¾ªç’°æŠ€è¡“ (ACBT)ã€è‚ŒåŠ›è¨“ç·´ã€åŠŸèƒ½æ€§æ´»å‹•ã€‚</li><li><b>ç›£æ¸¬</b>ï¼šé‹å‹•æ™‚å¯†åˆ‡æ³¨æ„ RR èˆ‡ SpO2ã€‚è‹¥å‡ºç¾<b>åé–å¼å‘¼å¸ (Paradoxical breathing)</b> æˆ–ç”¨ç›¡è¼”åŠ©è‚Œï¼Œä»£è¡¨ç—…äººéåº¦ç–²å‹ï¼Œæ‡‰æš«åœè¨“ç·´ã€‚</li></ul>',
      data: {
        'Mandatory Breath': 'æ©Ÿå™¨æ§åˆ¶ (ä¾‹å¦‚ 6-8 bpm)',
        'Spontaneous Breath': 'ç—…äººæ§åˆ¶ (æ±ºå®šå¤§å°èˆ‡å¿«æ…¢)',
        'Pressure Support': 'é€šå¸¸è¨­å®š 10-15 cmH2O',
        'WOB': 'æ©Ÿå™¨ 40-60% / ç—…äºº 40-60%'
      }
    }
  },
  {
    id: 'cpap',
    code: 'CPAP / PSV',
    name: 'Spontaneous / Pressure Support',
    severity: 'mild',
    severityText: 'è¼•åº¦ / è‡ªä¸»å‘¼å¸',
    desc: 'è‡ªä¸»å‘¼å¸æ¨¡å¼ã€‚ç—…äººæ±ºå®šæ€éº¼å¸ã€å¸å¤šå°‘ï¼Œæ©Ÿå™¨åªçµ¦äºˆå£“åŠ›æ”¯æŒèˆ‡ PEEPã€‚',
    content: {
      mechanism: '<b>æ§åˆ¶ä½ç½®ï¼šç—…äºº (Patient)</b><br>1. <b>CPAP</b>: æŒçºŒçµ¦äºˆæ­£å£“æ’é–‹è‚ºæ³¡ (å¢åŠ  FRC)ã€‚<br>2. <b>PSV</b>: å¸æ°£æ™‚çµ¦äºˆå£“åŠ›è¼”åŠ© (å…‹æœç®¡è·¯é˜»åŠ›)ã€‚<br>ç—…äººå…¨æ¬Šè² è²¬å‘¼å¸é »ç‡ (RR) èˆ‡æ½®æ°£é‡ (TV)ã€‚',
      pt_view: 'é€™æ˜¯æ‹”ç®¡å‰çš„æœ€å¾Œä¸€å“©è·¯ (SBT, Spontaneous Breathing Trial)ã€‚ç—…äººçš„å‘¼å¸è‚Œæ­£åœ¨å…¨è² è·é‹è½‰ã€‚è‹¥èƒ½åœ¨äº›æ¨¡å¼ä¸‹é‹å‹•ä¸”æ•¸å€¼ç©©å®šï¼Œæ‹”ç®¡æˆåŠŸç‡é«˜ã€‚',
      indication: '<ul><li>æ‹”ç®¡å‰è©•ä¼° (Weaning trial)ã€‚</li><li>é˜»å¡æ€§ç¡çœ å‘¼å¸ä¸­æ­¢ç—‡ (OSA)ã€‚</li><li>è¼•åº¦æ°§åˆå•é¡Œã€‚</li></ul>',
      contraindication: '<ul><li>å‘¼å¸ä¸­æ¨é©…å‹•åŠ›ä¸ç©© (Apnea)ã€‚</li><li>æ„è­˜ä¸æ¸…ã€ç„¡æ³•ä¿è­·å‘¼å¸é“ã€‚</li></ul>',
      complication: '<ul><li><b>å‘¼å¸æš«åœ (Apnea)</b>ï¼šæ©Ÿå™¨é€šå¸¸æœƒæœ‰å‚™æ´æ¨¡å¼ (Apnea Ventilation)ã€‚</li><li>ä½é€šæ°£ (Hypoventilation) å°è‡´é«˜äºŒæ°§åŒ–ç¢³ã€‚</li></ul>',
      pt_action: '<ul><li><b>ä»‹å…¥é‡é»</b>ï¼šé«˜å¼·åº¦åŠŸèƒ½è¨“ç·´ã€è€åŠ›è¨“ç·´ã€å’³å—½è¨“ç·´ã€‚</li><li><b>æ³¨æ„</b>ï¼šæ­¤æ¨¡å¼ä¸‹é‹å‹•ï¼Œç—…äººæœ€å®¹æ˜“å–˜ã€‚è‹¥ RR > 30-35 æˆ– SpO2 < 90% éœ€ç«‹å³ä¼‘æ¯ã€‚</li></ul>',
      data: {
        'Rate': 'ç—…äººæ±ºå®š',
        'Tidal Volume': 'ç—…äººæ±ºå®š',
        'PEEP': 'é€šå¸¸ 5-8 cmH2O',
        'WOB': 'æ©Ÿå™¨ 0-10% / ç—…äºº 90-100%'
      }
    }
  }
];

// --- SVG Waveform Generators ---
function getWaveform(type, color) {
  let path = '';
  // Generic Logic for Waveforms (Pressure vs Time)
  if(type === 'cmv') {
    // Square waves, identical, regular
    path = `M0 100 L10 100 L10 40 L60 40 L60 100 L110 100 L110 40 L160 40 L160 100 L210 100 L210 40 L260 40 L260 100 L300 100`;
  } else if(type === 'ac') {
    // Similar to CMV but with small dip before rise (Patient trigger)
    path = `M0 100 L20 100 Q25 110 30 100 L30 40 L80 40 L80 100 L120 100 Q125 110 130 100 L130 40 L180 40 L180 100 L300 100`;
  } else if(type === 'simv') {
    // Big breath (Machine) ... small breath (Patient) ... Big breath
    path = `M0 100 L10 100 L10 40 L60 40 L60 100 L80 100 Q85 105 90 90 L100 80 L110 90 L120 100 L150 100 L150 40 L200 40 L200 100 L230 100 Q235 105 240 90 L250 80 L260 90 L270 100 L300 100`;
  } else if(type === 'cpap') {
    // Baseline elevated (PEEP), irregular sine waves (Patient)
    path = `M0 80 Q20 60 40 80 T80 80 T120 80 T160 80 T200 80 T240 80 T280 80`; // Simplified sine
  }

  return `
    <svg viewBox="0 0 300 150" preserveAspectRatio="none">
      <!-- Grid -->
      <path d="M0 130 L300 130" stroke="#eee" stroke-width="2"/>
      <path d="M0 20 L300 20" stroke="#eee" stroke-width="2" stroke-dasharray="4"/>
      <text x="5" y="15" font-size="10" fill="#999">Pressure (cmH2O)</text>
      
      <!-- Waveform -->
      <path d="${path}" fill="none" stroke="${color}" stroke-width="3" stroke-linejoin="round" />
      
      <!-- Labels based on type -->
      ${type==='ac' ? '<text x="25" y="125" font-size="10" fill="#666">Trigger</text>' : ''}
      ${type==='simv' ? '<text x="20" y="30" font-size="10" fill="#666">Mandatory</text><text x="90" y="70" font-size="10" fill="#666">Spont.</text>' : ''}
      ${type==='cpap' ? '<text x="10" y="70" font-size="10" fill="#666">PEEP Level</text>' : ''}
    </svg>
  `;
}

// --- Render Logic ---
const navList = document.getElementById('navList');
const mainContent = document.getElementById('mainContent');

function renderNav() {
  navList.innerHTML = modes.map(m => `
    <div class="nav-item" onclick="renderMode('${m.id}')" id="nav-${m.id}">
      <div>
        <div class="nav-title" style="color:var(--sev-${m.severity})">${m.code}</div>
        <div class="nav-desc">${m.severityText}</div>
      </div>
      <div class="dot" style="background:var(--sev-${m.severity})"></div>
    </div>
  `).join('');
}

function renderMode(id) {
  // Active state
  document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
  document.getElementById(`nav-${id}`).classList.add('active');

  const m = modes.find(x => x.id === id);
  const colorVar = `var(--sev-${m.severity})`;
  
  // Color Class mapping
  let colorClass = 'c-blue';
  if(m.severity === 'critical') colorClass = 'c-red';
  if(m.severity === 'severe') colorClass = 'c-orange';
  if(m.severity === 'mod') colorClass = 'c-yellow';
  if(m.severity === 'mild') colorClass = 'c-green';

  mainContent.innerHTML = `
    <div class="mode-header">
      <div class="mode-title" style="color:${colorVar}">${m.code}</div>
      <div class="mode-meta">
        <span>${m.name}</span>
        <span>â€¢</span>
        <span style="font-weight:700; color:${colorVar}">${m.severityText}</span>
      </div>
      <p style="margin-top:12px; line-height:1.6;">${m.desc}</p>
    </div>

    <div class="waveform-box">
      ${getWaveform(m.id, colorVar)}
      <div class="waveform-label">Pressure-Time Waveform</div>
    </div>

    <div class="grid-2">
      <div class="card c-blue">
        <div class="card-title">âš™ ä½œç”¨æ©Ÿè½‰ (Mechanism)</div>
        <div class="content">${m.content.mechanism}</div>
      </div>
      <div class="card ${colorClass}">
        <div class="card-title">ğŸƒ ç‰©ç†æ²»ç™‚è§€é» (PT View)</div>
        <div class="content">${m.content.pt_view}</div>
      </div>
    </div>

    <div class="grid-2">
      <div class="card c-green">
        <div class="card-title">âœ… é©æ‡‰ç—‡ (Indications)</div>
        <ul>${m.content.indication}</ul>
      </div>
      <div class="card c-red">
        <div class="card-title">â›” ç¦å¿Œèˆ‡ä½µç™¼ç—‡ (Risks)</div>
        ${m.content.contraindication}
        <hr style="border:0; border-top:1px dashed #eee; margin:10px 0;">
        ${m.content.complication}
      </div>
    </div>

    <div class="card c-yellow" style="margin-bottom:24px;">
      <div class="card-title">ğŸ›¡ æ²»ç™‚ä»‹å…¥é ˆçŸ¥ (PT Action)</div>
      ${m.content.pt_action}
    </div>

    <div class="card">
      <div class="card-title" style="color:#64748b">ğŸ“Š è©³ç´°æ•¸æ“š (Parameters)</div>
      <table class="data-table">
        ${Object.entries(m.content.data).map(([k,v]) => `<tr><td>${k}</td><td>${v}</td></tr>`).join('')}
      </table>
    </div>

    <div style="margin-top:30px; border-top:1px solid #eee; padding-top:20px;">
      <div class="card-title" style="color:#64748b; margin-bottom:10px;">ğŸ“– å»¶ä¼¸é–±è®€ (Extended Reading)</div>
      <div style="font-size:14px; color:#666; line-height:1.6;">
        <p><b>è‚ºé †æ‡‰æ€§ (Compliance):</b> ä»£è¡¨è‚ºéƒ¨æ“´å¼µçš„é›£æ˜“åº¦ã€‚C = Î”V / Î”Pã€‚çº–ç¶­åŒ–æˆ–ARDSæœƒå°è‡´é †æ‡‰æ€§ä¸‹é™ (Stiff lung)ï¼Œæ­¤æ™‚éœ€è¼ƒé«˜å£“åŠ›æ‰èƒ½é”åˆ°ç›®æ¨™å®¹ç©ã€‚</p>
        <p><b>æ°£é“é˜»åŠ› (Resistance):</b> æ°£é«”æµå‹•çš„é˜»åŠ›ã€‚ç—°æ¶²é˜»å¡ã€æ”¯æ°£ç®¡ç—™æ”£æœƒå°è‡´é˜»åŠ›ä¸Šå‡ (High PIP, Normal Plateau)ã€‚</p>
        <p><b>Auto-PEEP:</b> æ°£é«”æ»¯ç•™ã€‚å¸¸è¦‹æ–¼ COPD æˆ–å‘¼å¸é »ç‡éå¿«æ™‚ã€‚PT é‹å‹•æ™‚è‹¥ç™¼ç¾ç—…äººåæ°£æ™‚é–“éçŸ­ï¼Œæ‡‰æš«åœä¸¦è©•ä¼°æ˜¯å¦èª¿æ•´æ´»å‹•å¼·åº¦ã€‚</p>
      </div>
    </div>
  `;

  // Scroll to top
  mainContent.scrollTop = 0;
  // Close mobile menu
  if(window.innerWidth <= 768) document.getElementById('sidebar').classList.remove('open');
}

// Mobile Menu
function toggleMenu(){
  document.getElementById('sidebar').classList.toggle('open');
}

// Init
renderNav();
renderMode('cmv'); // Default to most severe

</script>
</body>
</html>